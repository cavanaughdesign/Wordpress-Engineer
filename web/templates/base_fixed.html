<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}WordPress Engineer{% endblock %}</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    
    <!-- Alpine.js for reactive components -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Configure Tailwind -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        dark: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'bounce-slow': 'bounce 2s infinite',
                        'pulse-slow': 'pulse 3s infinite',
                        'gradient': 'gradient 3s ease infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        gradient: {
                            '0%, 100%': { backgroundPosition: '0% 50%' },
                            '50%': { backgroundPosition: '100% 50%' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="h-full bg-gray-50 dark:bg-dark-900 text-gray-900 dark:text-gray-100 transition-colors duration-300" 
      x-data="appData()" 
      x-init="init()">

    <!-- Navigation -->
    <nav class="fixed top-0 z-50 w-full bg-white dark:bg-dark-800 border-b border-gray-200 dark:border-dark-700 shadow-sm">
        <div class="px-3 py-3 lg:px-5 lg:pl-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center justify-start">
                    <button @click="toggleSidebar()" 
                            class="inline-flex items-center p-2 text-sm text-gray-500 rounded-lg sm:hidden hover:bg-gray-100 dark:hover:bg-dark-700 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:focus:ring-dark-600"
                            title="Toggle sidebar">
                        <i class="fas fa-bars w-6 h-6"></i>
                    </button>
                    <a href="{{ url_for('index') }}" class="flex ml-2 md:mr-24">
                        <div class="flex items-center">
                            <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center mr-3">
                                <i class="fab fa-wordpress text-white text-lg"></i>
                            </div>
                            <span class="self-center text-xl font-semibold sm:text-2xl whitespace-nowrap">
                                WordPress Engineer
                            </span>
                        </div>
                    </a>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Theme Toggle -->
                    <button @click="toggleDarkMode()" 
                            class="p-2 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-dark-700 rounded-lg transition-colors"
                            title="Toggle dark mode">
                        <i x-show="!darkMode" class="fas fa-moon"></i>
                        <i x-show="darkMode" class="fas fa-sun"></i>
                    </button>
                    
                    <!-- Notifications -->
                    <div class="relative" x-data="{ notificationsOpen: false }">
                        <button @click="notificationsOpen = !notificationsOpen" 
                                class="relative p-2 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-dark-700 rounded-lg transition-colors"
                                title="Notifications">
                            <i class="fas fa-bell"></i>
                            <span x-show="notifications.some(n => !n.read)" 
                                  class="absolute top-0 right-0 inline-flex items-center justify-center w-3 h-3 text-xs font-bold text-white bg-red-500 rounded-full"></span>
                        </button>
                        <div x-show="notificationsOpen" @click.outside="notificationsOpen = false"
                             x-transition:enter="transition ease-out duration-100"
                             x-transition:enter-start="transform opacity-0 scale-95"
                             x-transition:enter-end="transform opacity-100 scale-100"
                             x-transition:leave="transition ease-in duration-75"
                             x-transition:leave-start="transform opacity-100 scale-100"
                             x-transition:leave-end="transform opacity-0 scale-95"
                             class="absolute right-0 top-full mt-2 w-72 bg-white dark:bg-dark-700 rounded-md shadow-lg py-1 z-50 overflow-hidden">
                            <h3 class="px-4 py-2 text-sm font-semibold text-gray-800 dark:text-gray-100 border-b dark:border-dark-600">Notifications</h3>
                            <template x-for="notification in notifications" :key="notification.id">
                                <div :class="notification.read ? 'bg-gray-50 dark:bg-dark-800' : 'bg-blue-50 dark:bg-blue-900'"
                                     class="flex items-start px-4 py-3 border-b dark:border-dark-600 last:border-b-0 cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-600"
                                     @click="notification.read = true; showNotification(notification.message, notification.type, 0)">
                                    <div class="flex-shrink-0 pt-1">
                                        <i :class="{
                                            'fas fa-check-circle text-green-500': notification.type === 'success',
                                            'fas fa-exclamation-circle text-red-500': notification.type === 'error',
                                            'fas fa-exclamation-triangle text-yellow-500': notification.type === 'warning',
                                            'fas fa-info-circle text-blue-500': notification.type === 'info'
                                        }" class="w-4 h-4"></i>
                                    </div>
                                    <div class="ml-3 flex-1">
                                        <p class="text-sm font-medium" :class="notification.read ? 'text-gray-700 dark:text-gray-200' : 'text-gray-900 dark:text-white'" x-text="notification.message"></p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400" x-text="new Date(notification.timestamp).toLocaleString()"></p>
                                    </div>
                                </div>
                            </template>
                            <div x-show="notifications.length === 0" class="text-center py-4 text-sm text-gray-500 dark:text-gray-400">No new notifications</div>
                        </div>
                    </div>
                    
                    <!-- User Menu -->
                    <div class="flex items-center" x-data="{ open: false }">
                        <button @click="open = !open" class="flex text-sm bg-gray-800 rounded-full focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-600">
                            <img class="w-8 h-8 rounded-full" src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=32&h=32&fit=crop&crop=face" alt="user photo">
                        </button>
                        <div x-show="open" @click.outside="open = false" 
                             x-transition:enter="transition ease-out duration-100"
                             x-transition:enter-start="transform opacity-0 scale-95"
                             x-transition:enter-end="transform opacity-100 scale-100"
                             x-transition:leave="transition ease-in duration-75"
                             x-transition:leave-start="transform opacity-100 scale-100"
                             x-transition:leave-end="transform opacity-0 scale-95"
                             class="absolute right-0 top-full mt-2 w-48 bg-white dark:bg-dark-700 rounded-md shadow-lg py-1 z-50">
                            <a href="#" @click.prevent="switchTab('profile')" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-dark-600">
                                <i class="fas fa-user mr-2"></i>Profile
                            </a>
                            <a href="#" @click.prevent="switchTab('settings')" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-dark-600">
                                <i class="fas fa-cog mr-2"></i>Settings
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <aside :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full'"
           class="fixed top-0 left-0 z-40 w-64 h-screen pt-20 transition-transform bg-white dark:bg-dark-800 border-r border-gray-200 dark:border-dark-700 sm:translate-x-0">
        <div class="h-full px-3 pb-4 overflow-y-auto">
            <ul class="space-y-2 font-medium">
                <!-- Dashboard -->
                <li>
                    <a href="#" @click.prevent="switchTab('dashboard')"
                       :class="activeTab === 'dashboard' ? 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200' : 'text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-dark-700'"
                       class="flex items-center p-2 rounded-lg group transition-colors">
                        <i class="fas fa-tachometer-alt w-5 h-5"></i>
                        <span class="ml-3">Dashboard</span>
                    </a>
                </li>
                <!-- Profile -->
                <li>
                    <a href="#" @click.prevent="switchTab('profile')"
                       :class="activeTab === 'profile' ? 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200' : 'text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-dark-700'"
                       class="flex items-center p-2 rounded-lg group transition-colors">
                        <i class="fas fa-user w-5 h-5"></i>
                        <span class="ml-3">Profile</span>
                    </a>
                </li>
                  <!-- WordPress Development -->
                <li>
                    <a href="#" @click.prevent="switchTab('wordpress')"
                       :class="activeTab === 'wordpress' ? 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200' : 'text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-dark-700'"
                       class="flex items-center p-2 rounded-lg group transition-colors">
                        <i class="fab fa-wordpress w-5 h-5"></i>
                        <span class="ml-3">WordPress Dev</span>
                    </a>
                </li>
                
                <!-- Chat Interface -->
                <li>
                    <a href="#" @click.prevent="switchTab('chat')"
                       :class="activeTab === 'chat' ? 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200' : 'text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-dark-700'"
                       class="flex items-center p-2 rounded-lg group transition-colors">
                        <i class="fas fa-comments w-5 h-5"></i>
                        <span class="ml-3">Chat with Mike</span>
                        <span x-show="chatIntegrationAvailable" 
                              class="ml-2 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                            AI
                        </span>
                    </a>
                </li>
                
                <!-- Code Generator -->
                <li>
                    <a href="#" @click.prevent="switchTab('generator')"
                       :class="activeTab === 'generator' ? 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200' : 'text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-dark-700'"
                       class="flex items-center p-2 rounded-lg group transition-colors">
                        <i class="fas fa-code w-5 h-5"></i>
                        <span class="ml-3">Code Generator</span>
                    </a>
                </li>
                
                <!-- File Manager -->
                <li>
                    <a href="#" @click.prevent="switchTab('files')"
                       :class="activeTab === 'files' ? 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200' : 'text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-dark-700'"
                       class="flex items-center p-2 rounded-lg group transition-colors">
                        <i class="fas fa-folder w-5 h-5"></i>
                        <span class="ml-3">File Manager</span>
                    </a>
                </li>

                <!-- Code Validator -->
                <li>
                    <a href="#" @click.prevent="switchTab('validator')"
                       :class="activeTab === 'validator' ? 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200' : 'text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-dark-700'"
                       class="flex items-center p-2 rounded-lg group transition-colors">
                        <i class="fas fa-check-circle w-5 h-5"></i>
                        <span class="ml-3">Code Validator</span>
                    </a>
                </li>
                
                <!-- Terminal -->
                <li>
                    <a href="#" @click.prevent="switchTab('terminal')"
                       :class="activeTab === 'terminal' ? 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200' : 'text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-dark-700'"
                       class="flex items-center p-2 rounded-lg group transition-colors">
                        <i class="fas fa-terminal w-5 h-5"></i>
                        <span class="ml-3">Terminal</span>
                    </a>
                </li>
                
                <!-- Analytics -->
                <li>
                    <a href="#" @click.prevent="switchTab('analytics')"
                       :class="activeTab === 'analytics' ? 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200' : 'text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-dark-700'"
                       class="flex items-center p-2 rounded-lg group transition-colors">
                        <i class="fas fa-chart-bar w-5 h-5"></i>
                        <span class="ml-3">Analytics</span>
                    </a>
                </li>
                
                <!-- Settings -->
                <li>
                    <a href="#" @click.prevent="switchTab('settings')"
                       :class="activeTab === 'settings' ? 'bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-200' : 'text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-dark-700'"
                       class="flex items-center p-2 rounded-lg group transition-colors">
                        <i class="fas fa-cog w-5 h-5"></i>
                        <span class="ml-3">Settings</span>
                    </a>
                </li>
            </ul>
        </div>
    </aside>    <!-- Main Content -->
    <div class="p-4 sm:ml-64">
        <div class="p-4 border-2 border-gray-200 dark:border-dark-600 border-dashed rounded-lg mt-14">
            {% block content %}{% endblock %}
        </div>
    </div>

    <!-- Notification System -->
    <div class="fixed top-16 right-4 z-50 space-y-2">
        <template x-for="notification in notifications.filter(n => n.visible)" :key="notification.id">
            <div 
                 x-show="notification.visible"
                 @mouseenter="notification.paused = true"
                 @mouseleave="notification.paused = false"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-x-full"
                 x-transition:enter-end="opacity-100 transform translate-x-0"
                 x-transition:leave="transition ease-in duration-300"
                 x-transition:leave-start="opacity-100 transform translate-x-0"
                 x-transition:leave-end="opacity-0 transform translate-x-full"
                 :class="{
                     'bg-green-100 border-green-400 text-green-700 dark:bg-green-800 dark:border-green-600 dark:text-green-100': notification.type === 'success',
                     'bg-red-100 border-red-400 text-red-700 dark:bg-red-800 dark:border-red-600 dark:text-red-100': notification.type === 'error',
                     'bg-yellow-100 border-yellow-400 text-yellow-700 dark:bg-yellow-800 dark:border-yellow-600 dark:text-yellow-100': notification.type === 'warning',
                     'bg-blue-100 border-blue-400 text-blue-700 dark:bg-blue-800 dark:border-blue-600 dark:text-blue-100': notification.type === 'info'
                 }"
                 class="max-w-sm w-full shadow-lg rounded-lg pointer-events-auto border-l-4">
                <div class="p-4">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                             <i :class="{
                                'fas fa-check-circle': notification.type === 'success',
                                'fas fa-times-circle': notification.type === 'error',
                                'fas fa-exclamation-triangle': notification.type === 'warning',
                                'fas fa-info-circle': notification.type === 'info'
                            }" class="w-5 h-5"></i>
                        </div>
                        <div class="ml-3 w-0 flex-1">
                            <p class="text-sm font-medium" x-text="notification.message"></p>
                        </div>
                        <div class="ml-4 flex-shrink-0 flex">
                            <button @click="removeNotification(notification.id)"
                                    class="inline-flex text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none">
                                <i class="fas fa-times w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </template>
    </div>

    <!-- Custom JavaScript -->
  <!-- Custom JavaScript -->
    <!-- Temporarily disabled to test Alpine.js -->
    <!-- <script src="{{ url_for('static', filename='js/main_compatible.js') }}"></script> -->
    
    <!-- Alpine.js Data Initialization -->
    <script>
        function appData() {
            return {
                // Core state
                darkMode: localStorage.getItem('darkMode') === 'true' || false,
                sidebarOpen: window.innerWidth >= 1024,
                activeTab: 'dashboard',
                
                // Integration status
                aiIntegrationAvailable: false,
                chatIntegrationAvailable: false,
                ragDatabaseAvailable: false,
                
                // Form data
                pluginData: {
                    description: '',
                    name: '',
                    complexity: 'intermediate',
                    isGenerating: false,
                    result: null
                },
                themeData: {
                    description: '',
                    name: '',
                    style: 'modern',
                    isGenerating: false,
                    result: null
                },
                validatorData: {
                    code: '',
                    codeType: 'php',
                    results: null,
                    isValidating: false
                },
                
                // Security scan data
                securityData: {
                    path: 'C:\\xampp\\htdocs\\wordpress',
                    isScanning: false,
                    results: null
                },
                
                // Database optimization data
                databaseData: {
                    host: 'localhost',
                    user: 'wordpress',
                    password: '',
                    database: 'wordpress',
                    isOptimizing: false,
                    results: null
                },
                
                // Terminal
                terminalData: {
                    command: '',
                    output: '',
                    history: [],
                    historyIndex: -1,
                    isExecuting: false,

                    historyUp() {
                        if (this.historyIndex > 0) {
                            this.historyIndex--;
                            this.command = this.history[this.historyIndex];
                        }
                    },

                    historyDown() {
                        if (this.historyIndex < this.history.length - 1) {
                            this.historyIndex++;
                            this.command = this.history[this.historyIndex];
                        } else {
                            this.historyIndex = this.history.length;
                            this.command = '';
                        }
                    }
                },
                
                // Chat data
                chatData: {
                    messages: [],
                    currentSessionId: null,
                    isRecording: false,
                    isLoading: false,
                    newMessage: '',
                    uploadedImages: [],
                    isTyping: false
                },
                
                // File manager
                fileManager: {
                    currentPath: '/',
                    files: [],
                    selectedFiles: [],
                    isLoading: false,
                    currentFile: null,
                    fileContent: '',
                    isSaving: false,

                    async navigate(path) {
                        this.loadFiles(path);
                    },

                    async readFile(path) {
                        this.currentFile = path;
                        try {
                            const response = await fetch(`/api/files/read?path=${encodeURIComponent(path)}`);
                            const result = await response.json();
                            if (result.status === 'success') {
                                this.fileContent = result.content;
                            } else {
                                this.showNotification('Error reading file: ' + (result.error || 'Unknown error'), 'error');
                            }
                        } catch (error) {
                            this.showNotification('Error reading file: ' + error.message, 'error');
                        }
                    },

                    async saveFile() {
                        if (!this.currentFile) {
                            this.showNotification('No file selected to save', 'error');
                            return;
                        }
                        this.isSaving = true;
                        try {
                            const response = await fetch('/api/files/write', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    path: this.currentFile,
                                    content: this.fileContent
                                })
                            });
                            const result = await response.json();
                            if (result.status === 'success') {
                                this.showNotification('File saved successfully!', 'success');
                            } else {
                                this.showNotification('Error saving file: ' + (result.error || 'Unknown error'), 'error');
                            }
                        } catch (error) {
                            this.showNotification('Error saving file: ' + error.message, 'error');
                        } finally {
                            this.isSaving = false;
                        }
                    },

                    downloadFile() {
                        if (!this.currentFile) {
                            this.showNotification('No file selected to download', 'error');
                            return;
                        }
                        const blob = new Blob([this.fileContent], { type: 'text/plain' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = this.currentFile.split('/').pop();
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    }
                },
                
                // Analytics
                analytics: {
                    stats: {
                        lines_of_code: 0,
                        projects: 0,
                        plugins: 0,
                        themes: 0,
                        security_score: 0,
                        performance_score: 0,
                        activity: [],
                        recent_projects: [],
                        languages: {}
                    },
                    activityData: [],
                    performanceData: [],
                    isLoading: false
                },
                
                // Notification system
                notifications: [],
                notificationsEnabled: localStorage.getItem('notificationsEnabled') === 'true',
                
                // Methods
                
                // Core UI methods
                toggleDarkMode() {
                    this.darkMode = !this.darkMode;
                },
                
                toggleSidebar() {
                    this.sidebarOpen = !this.sidebarOpen;
                },
                
                switchTab(tab) {
                    this.activeTab = tab;
                    console.log('Switched to tab:', tab);
                    
                    // Load tab-specific data
                    this.loadTabData(tab);
                },
                
                loadTabData(tab) {
                    switch(tab) {
                        case 'chat':
                            if (!this.chatData.currentSessionId && this.chatIntegrationAvailable) {
                                this.startChatSession();
                            }
                            break;
                        case 'files':
                            this.loadFiles();
                            break;
                        case 'analytics':
                            this.loadAnalytics();
                            break;
                    }
                },
                
                // Notification methods
                showNotification(message, type = 'info', duration = 5000) {
                    if (!this.notificationsEnabled) {
                        console.log('Notifications are disabled. Message:', message);
                        return;
                    }
                    const notification = {
                        id: Date.now(),
                        message,
                        type,
                        read: false, // New notifications are unread by default
                        timestamp: Date.now(),
                        visible: true
                    };
                    
                    this.notifications.unshift(notification); // Add to the beginning
                    
                    if (duration > 0) {
                        setTimeout(() => {
                            this.removeNotification(notification.id);
                        }, duration);
                    }
                },
                
                removeNotification(id) {
                    const index = this.notifications.findIndex(n => n.id === id);
                    if (index > -1) {
                        this.notifications.splice(index, 1);
                    }
                },

                toggleNotifications() {
                    this.notificationsEnabled = !this.notificationsEnabled;
                    localStorage.setItem('notificationsEnabled', this.notificationsEnabled);
                    this.showNotification(`Notifications ${this.notificationsEnabled ? 'enabled' : 'disabled'}`, 'info');
                },

                saveSettings() {
                    // Placeholder for saving settings. Actual implementation would involve API calls.
                    this.showNotification('Settings saved successfully!', 'success');
                },
                
                // Plugin Generation
                async generatePlugin() {
                    if (!this.pluginData.name || !this.pluginData.description) {
                        this.showNotification('Please fill in all required fields', 'error');
                        return;
                    }
                    
                    this.pluginData.isGenerating = true;
                    this.showNotification('Generating plugin...', 'info');
                    
                    try {
                        const response = await fetch('/api/generate/plugin', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                description: this.pluginData.description,
                                name: this.pluginData.name,
                                complexity: this.pluginData.complexity
                            })
                        });
                        
                        const result = await response.json();
                        
                        if (result.status === 'success') {
                            this.pluginData.result = result;
                            this.showNotification('Plugin generated successfully!', 'success');
                        } else {
                            this.showNotification('Error generating plugin: ' + (result.error || 'Unknown error'), 'error');
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        this.showNotification('Error generating plugin: ' + error.message, 'error');
                    } finally {
                        this.pluginData.isGenerating = false;
                    }
                },
                
                // Theme Generation
                async generateTheme() {
                    if (!this.themeData.name || !this.themeData.description) {
                        this.showNotification('Please fill in all required fields', 'error');
                        return;
                    }
                    
                    this.themeData.isGenerating = true;
                    this.showNotification('Generating theme...', 'info');
                    
                    try {
                        const response = await fetch('/api/generate/theme', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                description: this.themeData.description,
                                name: this.themeData.name,
                                style: this.themeData.style
                            })
                        });
                        
                        const result = await response.json();
                        
                        if (result.status === 'success') {
                            this.themeData.result = result;
                            this.showNotification('Theme generated successfully!', 'success');
                        } else {
                            this.showNotification('Error generating theme: ' + (result.error || 'Unknown error'), 'error');
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        this.showNotification('Error generating theme: ' + error.message, 'error');
                    } finally {
                        this.themeData.isGenerating = false;
                    }
                },

                // Code Validation
                async validateCode() {
                    if (!this.validatorData.code.trim()) {
                        this.showNotification('Please enter some code to validate', 'error');
                        return;
                    }
                    
                    this.validatorData.isValidating = true;
                    this.showNotification('Validating code...', 'info');
                    
                    try {
                        const response = await fetch('/api/code/validate', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                code: this.validatorData.code,
                                type: this.validatorData.codeType
                            })
                        });
                        
                        const result = await response.json();
                        
                        if (result.status === 'success') {
                            this.validatorData.results = {
                                score: result.validation_results?.score || result.score,
                                issues: result.validation_results?.issues || [],
                                suggestions: result.validation_results?.suggestions || result.suggestions,
                                codeQuality: result.validation_results?.code_quality || result.code_quality,
                                aiAnalysis: result.validation_results?.ai_analysis
                            };
                            this.showNotification('Code validation completed!', 'success');
                        } else {
                            this.showNotification('Error validating code: ' + (result.error || 'Unknown error'), 'error');
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        this.showNotification('Error validating code: ' + error.message, 'error');
                    } finally {
                        this.validatorData.isValidating = false;
                    }
                },
                
                // Security Scan
                async runSecurityScan() {
                    this.securityData.isScanning = true;
                    this.showNotification('Starting security scan...', 'info');
                    
                    try {
                        const response = await fetch('/api/security/scan', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                path: this.securityData.path
                            })
                        });
                        
                        const result = await response.json();
                        
                        if (result.status === 'success') {
                            this.securityData.results = result.scan_results;
                            this.showNotification('Security scan completed!', 'success');
                        } else {
                            this.showNotification('Error running security scan: ' + (result.error || 'Unknown error'), 'error');
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        this.showNotification('Error running security scan: ' + error.message, 'error');
                    } finally {
                        this.securityData.isScanning = false;
                    }
                },
                
                // Database Optimization
                async optimizeDatabase() {
                    this.databaseData.isOptimizing = true;
                    this.showNotification('Optimizing database...', 'info');
                    
                    try {
                        const response = await fetch('/api/database/optimize', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                host: this.databaseData.host,
                                user: this.databaseData.user,
                                password: this.databaseData.password,
                                database: this.databaseData.database
                            })
                        });
                        
                        const result = await response.json();
                        
                        if (result.status === 'success') {
                            this.databaseData.results = result.optimization_results;
                            this.showNotification('Database optimization completed!', 'success');
                        } else {
                            this.showNotification('Error optimizing database: ' + (result.error || 'Unknown error'), 'error');
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        this.showNotification('Error optimizing database: ' + error.message, 'error');
                    } finally {
                        this.databaseData.isOptimizing = false;
                    }
                },
                
                // Terminal Operations
                async executeCommand() {
                    if (!this.terminalData.command.trim()) {
                        return;
                    }
                    
                    const commandToExecute = this.terminalData.command;
                    this.terminalData.history.push(commandToExecute);
                    this.terminalData.historyIndex = this.terminalData.history.length;
                    this.terminalData.isExecuting = true;
                    this.terminalData.output += `\n<span class="text-blue-400">wordpress@engineer:~$</span> ${commandToExecute}`;

                    try {
                        const response = await fetch('/api/terminal/execute', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                command: commandToExecute
                            })
                        });
                        
                        const result = await response.json();
                        
                        if (result.output) {
                            this.terminalData.output += `\n${result.output}`;
                        }
                        if (result.error) {
                            this.terminalData.output += `\n<span class="text-red-400">${result.error}</span>`;
                        }

                    } catch (error) {
                        this.terminalData.output += `\n<span class="text-red-400">Error: ${error.message}</span>`;
                    } finally {
                        this.terminalData.command = '';
                        this.terminalData.isExecuting = false;
                        this.$nextTick(() => {
                            this.$refs.terminal.scrollTop = this.$refs.terminal.scrollHeight;
                        });
                    }
                },
                
                // Chat Integration
                async loadChatStatus() {
                    try {
                        const response = await fetch('/api/status');
                        const status = await response.json();
                        
                        this.aiIntegrationAvailable = status.ai_integration?.available || false;
                        this.chatIntegrationAvailable = status.chat_integration?.available || false;
                        this.ragDatabaseAvailable = status.rag_database?.available || false;
                        
                        console.log('Integration status loaded:', {
                            ai: this.aiIntegrationAvailable,
                            chat: this.chatIntegrationAvailable,
                            rag: this.ragDatabaseAvailable
                        });
                    } catch (error) {
                        console.error('Error loading integration status:', error);
                        this.showNotification('Could not load integration status', 'warning');
                    }
                },
                
                async startChatSession() {
                    if (!this.chatIntegrationAvailable) {
                        this.showNotification('Chat integration not available', 'error');
                        return;
                    }
                    
                    try {
                        const response = await fetch('/api/chat/start', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                session_id: `session_${Date.now()}`
                            })
                        });
                        
                        const result = await response.json();
                        
                        if (result.status === 'success') {
                            this.chatData.currentSessionId = result.session_id;
                            this.showNotification('Chat session started!', 'success');
                        } else {
                            this.showNotification('Error starting chat: ' + (result.error || result.message), 'error');
                        }
                    } catch (error) {
                        console.error('Error starting chat:', error);
                        this.showNotification('Error starting chat: ' + error.message, 'error');
                    }
                },
                
                async sendChatMessage() {
                    if ((!this.chatData.newMessage.trim() && this.chatData.uploadedImages.length === 0) || !this.chatData.currentSessionId) {
                        return;
                    }

                    const messageContent = this.chatData.newMessage;
                    const imagesToSend = [...this.chatData.uploadedImages];
                    
                    // Add user message to chat UI
                    this.chatData.messages.push({
                        role: 'user',
                        content: messageContent,
                        images: imagesToSend,
                        timestamp: Date.now()
                    });

                    // Clear inputs
                    this.chatData.newMessage = '';
                    this.chatData.uploadedImages = [];
                    
                    this.chatData.isLoading = true;
                    
                    try {
                        const response = await fetch('/api/chat/message', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                session_id: this.chatData.currentSessionId,
                                message: messageContent,
                                // Assuming the backend handles the image paths from a previous upload step
                                // This part of the logic might need adjustment based on the exact implementation
                                image_path: imagesToSend.length > 0 ? imagesToSend[0].path : null
                            })
                        });
                        
                        const result = await response.json();
                        if (result.status === 'success') {
                            this.chatData.messages.push({
                                role: 'assistant',
                                content: result.response,
                                timestamp: Date.now()
                            });
                        } else {
                            this.showNotification('Error sending message: ' + (result.error || result.message), 'error');
                        }
                    } catch (error) {
                        console.error('Error sending message:', error);
                        this.showNotification('Error sending message: ' + error.message, 'error');
                    } finally {
                        this.chatData.isLoading = false;
                        this.$nextTick(() => {
                            this.$refs.chatArea.scrollTop = this.$refs.chatArea.scrollHeight;
                        });
                    }
                },
                
                async clearChatSession() {
                    if (!this.chatData.currentSessionId) return;
                    
                    try {
                        const response = await fetch('/api/chat/clear', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                session_id: this.chatData.currentSessionId
                            })
                        });
                        
                        const result = await response.json();
                        
                        if (result.status === 'success') {
                            this.chatData.messages = [];
                            this.chatData.currentSessionId = null;
                            this.chatData.uploadedImages = [];
                            this.showNotification('Chat session cleared!', 'success');
                        } else {
                            this.showNotification('Error clearing session: ' + (result.error || result.message), 'error');
                        }
                    } catch (error) {
                        console.error('Error clearing chat session:', error);
                        this.showNotification('Error clearing session: ' + error.message, 'error');
                    }
                },
                
                // Voice Integration
                async startVoiceRecording() {
                    if (!this.chatIntegrationAvailable) {
                        this.showNotification('Voice input requires chat integration', 'error');
                        return;
                    }
                    
                    this.chatData.isRecording = !this.chatData.isRecording;
                    
                    if (this.chatData.isRecording) {
                        this.showNotification('Voice recording started...', 'info');
                        // Implement actual voice recording
                    } else {
                        this.showNotification('Voice recording stopped', 'info');
                        // Process recorded voice
                    }
                },
                
                // Image Upload for Chat
                async uploadImageForChat(event) {
                    const files = Array.from(event.target.files);
                    
                    for (const file of files) {
                        if (file.type.startsWith('image/')) {
                            const formData = new FormData();
                            formData.append('file', file);
                            formData.append('session_id', this.chatData.currentSessionId || 'temp');
                            
                            try {
                                const response = await fetch('/api/chat/upload', {
                                    method: 'POST',
                                    body: formData
                                });
                                
                                const result = await response.json();
                                
                                if (result.status === 'success') {
                                    this.chatData.uploadedImages.push({
                                        name: result.filename,
                                        path: result.path,
                                        url: URL.createObjectURL(file)
                                    });
                                    this.showNotification('Image uploaded successfully!', 'success');
                                } else {
                                    this.showNotification('Error uploading image: ' + (result.error || 'Unknown error'), 'error');
                                }
                            } catch (error) {
                                console.error('Error uploading image:', error);
                                this.showNotification('Error uploading image: ' + error.message, 'error');
                            }
                        }
                    }
                },
                
                // Remove uploaded image from chat
                removeUploadedImage(index) {
                    this.chatData.uploadedImages.splice(index, 1);
                },
                
                // File Management
                async loadFiles(path = '/') {
                    this.fileManager.isLoading = true;
                    
                    try {
                        const response = await fetch(`/api/files/list?path=${encodeURIComponent(path)}`);
                        const result = await response.json();
                        
                        if (result.status === 'success') {
                            this.fileManager.files = result.files;
                            this.fileManager.currentPath = result.path;
                        } else {
                            this.showNotification('Error loading files: ' + (result.error || 'Unknown error'), 'error');
                        }
                    } catch (error) {
                        console.error('Error loading files:', error);
                        this.showNotification('Error loading files: ' + error.message, 'error');
                    } finally {
                        this.fileManager.isLoading = false;
                    }
                },
                
                // Analytics
                async loadAnalytics() {
                    this.analytics.isLoading = true;
                    
                    try {
                        const response = await fetch('/api/analytics/stats');
                        const result = await response.json();
                        
                        if (result.status === 'success') {
                            this.analytics.stats = result.stats;
                            this.analytics.activityData = result.stats.activity || [];
                            this.analytics.performanceData = result.stats.languages || {};
                        } else {
                            this.showNotification('Error loading analytics: ' + (result.error || 'Unknown error'), 'error');
                        }
                    } catch (error) {
                        console.error('Error loading analytics:', error);
                        this.showNotification('Error loading analytics: ' + error.message, 'error');
                    } finally {
                        this.analytics.isLoading = false;
                    }
                },
                
                // Initialization
                async init() {
                    // Watch for dark mode changes
                    this.$watch('darkMode', val => {
                        localStorage.setItem('darkMode', val);
                        if (val) {
                            document.documentElement.classList.add('dark');
                        } else {
                            document.documentElement.classList.remove('dark');
                        }
                    });
                    
                    // Apply initial dark mode
                    if (this.darkMode) {
                        document.documentElement.classList.add('dark');
                    }
                    
                    // Load integration status
                    await this.loadChatStatus();
                    
                    // Load initial data
                    this.loadTabData(this.activeTab);
                    
                    console.log('WordPress Engineer Web Interface initialized successfully');
                    this.showNotification('WordPress Engineer ready!', 'success', 3000);
                }
            }
        }
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>
